# AWS CodeDeploy 배포 후기

한달전쯤에 AWS 배포를 위한 구성과 설정을 처리했으나 사내 인테리어 공사로 인해서 3주정도 재택을 하면서  
CodeDeploy 배포가 늦어지게 되었고 한달전쯤 작성한 <a href="https://github.com/rumor1993/TIL/blob/main/AWS/CodeDeploy.md">AWS CodeDeploy를 활용한 자동배포 (CodeDeploy)</a> 라는 포스트에 결과를 작성하게 되었다.

## AWS CodeDeploy 운영배포 계획

1.  서비스에 영향이 적은 JS 부분에 대해서 배포를 진행하도록 했다.
2.  운영중인 WAS 10대중에 A, B, C 가용영역별로 한대의 서버에 적용을 한다
3.  배포를 진행하기 전 백업파일을 통해서 장애 발생시 복구 작업을 준비한다.
4.  스카우터를 통해서 적용서버와 미적용서버 간에 상태 체크 및 모니터링을 진행한다.
5.  배포를 진행하는 서버에 접속해 로그를 실행한 상태를 유지한다.
6.  배포 완료 후 서버 별 배포여부 체크 및 서버 상태 체크를 한다.

운영서버에 배포를 하는 작업은 사실 간단한 작업이라고 해도 서비스에 영향을 줄 수 있는 부분이 있기 때문에 충분한 계획을 토대로  
진행을 해야한다. 이전에는 간단한 작업이라 생각하고 계획이나 테스트를 진행하지 않고 배포를 해버렸는데 서버에 에러가 밸생했던  
경험이 있었고 이를 토대로 배포에 가장 중요한 부분은 테스트와 배포 전후 계획이 필요하다고 생각했다.

## 부분배포

부분적으로 정해놓은 영역별 WAS에 정삭적으로 배포가 완료되었고 이를 토대로 전체 배포를 진행하기로 했다.  
배포 설정을 통해서 전체 10대에 서버에 대한 태그를 통해서 배포 그룹을 생성해주었고 배포에 백분율을 80%로  
설정하고 배포를 진행하기로 했다.

- 80%로 설정을 하게 되면 인스턴스에 80%가 정상화가 되어있는 상태를 유지해야만 배포가 성공한다.

## 배포결과

![image](https://user-images.githubusercontent.com/38723165/129549537-c6d4f01c-9321-4321-a748-84fa1f71f924.png)

10대에 WAS서버에 상태를 확인해보면 모두 정상으로 처리가 되었고 CodeDeploy 배포에 설정값을 토대로 영역별 WAS가 동시에 배포가 진행되고 처리가 되었다. JS의 경우 서버에 대해서 재시작이 필요하지 않아서 로드밸런싱을 토대로 트래픽에 대한 차단 및 허용에 대한 설정은 따로 적용하지 않았다. 이를 사용해서 배포를 진행해보았을떄는 사용중인 트래픽을 막고 안전한 상태가 되면 배포를 진행하고 이후에 다시 트래픽을 열어주는 방식이 추가가 된다. 하지만 JS와 같은 파일의 경우 불필요한 작업이라 제거하고 진행했다 ( 트래픽 차단을 사용하면 생각보다 긴 시간이 소요된다. 약 5~7분이 걸렸다 )

## 느낀점

21년에는 파트원들과 함께 클라우드 운영에 대한 업무를 받게 되어서 전체적인 배포와 운영을 맡고 있는데 각 분기별로 클라우드 운영에  
도움이 되는 프로젝트를 본인이 개별적으로 선정해 진행중인데 그 프로젝트 중 하나인 자동배포가 성공적으로 처리되어서 기쁘다.

배포를 두려워하지 않도록 더욱 안전하고 효율적인 방법을 찾고 이를 적용해서 안정적인 서비스 운영을 해야겠다.
